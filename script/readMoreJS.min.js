window.applyReadmore = function (config) {
	const options = {
		target: '',
		numOfWords: 50,
		toggle: true,
		moreLink: 'read more...',
		lessLink: 'read less',
		linkClass: 'rm-link',
		containerClass: false,
		...config
	};

	const countWords = function (str) {
		return str.split(/\s+/).length;
	};

	const generateTrimmed = function (str, wordsNum) {
		return str.split(/\s+/).slice(0, wordsNum).join(' ') + '...';
	};

	const id = 'read-more_' + Math.random().toString(36).substr(2, 9);

	const element = document.querySelector(options.target);

	if (!element) {
		return;
	}

	const text = element.innerHTML;

	const len = countWords(text);
	const trimmedText = generateTrimmed(text, options.numOfWords);

	if (options.numOfWords < len - 1) {
		const readmoreLink = document.createElement('a');

		readmoreLink.setAttribute('data-read-more', 'target');

		readmoreLink.id = id;
		readmoreLink.style.cursor = 'pointer';
		readmoreLink.innerText = options.moreLink;
		readmoreLink.classList.add('readmore-link');
		
		element.setAttribute('data-readmore-full-text', encodeURIComponent(text));
		element.innerHTML = trimmedText;

		const wrapper = document.createElement('div');
		wrapper.appendChild(readmoreLink);

		element.appendChild(wrapper);
	}
};

window.resetReadmore = function() {

}

window.addEventListener('click', e => {
	e.preventDefault();
	
	if (e.target && e.target.dataset.readMore === 'target') {
		const textHTML = e.target.closest('[data-readmore-full-text]');

		if (textHTML) {
			const content = decodeURIComponent(textHTML.dataset.readmoreFullText);

			textHTML.innerHTML = content;
		}
	}
})